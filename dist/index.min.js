!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@babel/runtime/helpers/extends"),require("d3-ease"),require("prop-types"),require("react"),require("d3-hierarchy")):"function"==typeof define&&define.amd?define(["exports","@babel/runtime/helpers/extends","d3-ease","prop-types","react","d3-hierarchy"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).ReactTreeGraph={},e._extends,e.d3,e.PropTypes,e.React,e.d3)}(this,(function(e,t,s,r,i,a){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}var p=o(t),d=o(r),n=o(i);function u(e){const t=e.width-e.margins.left-e.margins.right,s=e.height-e.margins.top-e.margins.bottom;let r=a.hierarchy(e.data,e.getChildren),i=a.tree().size([s,t])(r),o=i.descendants(),p=i.links();return o.forEach((t=>{t.y+=e.margins.top})),{nodes:o,links:p}}const l=/on[A-Z]/;function h(e,t){return s=>e(s,...t)}function c(e){for(var t=arguments.length,s=new Array(t>1?t-1:0),r=1;r<t;r++)s[r-1]=arguments[r];const i=Object.keys(e).filter((t=>l.test(t)&&"function"==typeof e[t])),a=i.reduce(((t,r)=>(t[r]=h(e[r],s),t)),{});return{...e,...a}}function f(e,t,s,r){return`M${t},${e}C${(t+r)/2},${e} ${(t+r)/2},${s} ${r},${s}`}class g extends n.default.PureComponent{static propTypes={source:d.default.object.isRequired,target:d.default.object.isRequired,keyProp:d.default.string.isRequired,x1:d.default.number.isRequired,x2:d.default.number.isRequired,y1:d.default.number.isRequired,y2:d.default.number.isRequired,pathFunc:d.default.func.isRequired,pathProps:d.default.object.isRequired};static defaultProps={pathFunc:f};render(){const e=c(this.props.pathProps,this.props.source.data[this.props.keyProp],this.props.target.data[this.props.keyProp]),t=this.props.pathFunc(this.props.x1,this.props.y1,this.props.x2,this.props.y2);return n.default.createElement("path",p.default({},e,{d:t}))}}class P extends n.default.PureComponent{static propTypes={x:d.default.number.isRequired,y:d.default.number.isRequired,keyProp:d.default.string.isRequired,labelProp:d.default.string.isRequired,shape:d.default.string.isRequired,nodeProps:d.default.object.isRequired,gProps:d.default.object.isRequired,textProps:d.default.object.isRequired};getTransform(){return`translate(${this.props.y}, ${this.props.x})`}render(){let e=0,t=this.props.nodeProps;switch(this.props.shape){case"circle":t={r:5,...t},e=t.r;break;case"image":case"rect":t={height:10,width:10,...t},t={x:-t.width/2,y:-t.height/2,...t},e=t.width/2}const s=c(t,this.props[this.props.keyProp]),r=c(this.props.gProps,this.props[this.props.keyProp]),i=c(this.props.textProps,this.props[this.props.keyProp]),a="string"==typeof this.props[this.props.labelProp]?n.default.createElement("text",p.default({dx:e+.5,dy:5},i),this.props[this.props.labelProp]):n.default.createElement("g",p.default({transform:`translate(${e+.5}, 5)`},i),this.props[this.props.labelProp]);return n.default.createElement("g",p.default({},r,{transform:this.getTransform()}),n.default.createElement(this.props.shape,s),a)}}class m extends n.default.PureComponent{static propTypes={children:d.default.node,height:d.default.number.isRequired,keyProp:d.default.string.isRequired,labelProp:d.default.string.isRequired,links:d.default.array.isRequired,nodes:d.default.array.isRequired,nodeClassName:d.default.string,nodeShape:d.default.string.isRequired,nodeProps:d.default.object.isRequired,pathFunc:d.default.func,width:d.default.number.isRequired,gProps:d.default.object.isRequired,pathProps:d.default.object.isRequired,svgProps:d.default.object.isRequired,textProps:d.default.object.isRequired};render(){return n.default.createElement("svg",p.default({},this.props.svgProps,{height:this.props.height,width:this.props.width}),this.props.children,n.default.createElement("g",null,this.props.links.map((e=>n.default.createElement(g,{key:e.target.data[this.props.keyProp],keyProp:this.props.keyProp,pathFunc:this.props.pathFunc,source:e.source,target:e.target,x1:e.source.x,x2:e.target.x,y1:e.source.y,y2:e.target.y,pathProps:{...this.props.pathProps,...e.target.data.pathProps}}))),this.props.nodes.map((e=>n.default.createElement(P,p.default({key:e.data[this.props.keyProp],keyProp:this.props.keyProp,labelProp:this.props.labelProp,shape:this.props.nodeShape,x:e.x,y:e.y,nodeProps:{...this.props.nodeProps,...e.data.nodeProps},gProps:{...this.props.gProps,...e.data.gProps},textProps:{...this.props.textProps,...e.data.textProps}},e.data))))))}}class y extends n.default.PureComponent{static propTypes={getChildren:d.default.func.isRequired,keyProp:d.default.string.isRequired,links:d.default.array.isRequired,nodes:d.default.array.isRequired,duration:d.default.number.isRequired,easing:d.default.func.isRequired,steps:d.default.number.isRequired};constructor(e){super(e);let t=e.nodes[0].x,s=e.nodes[0].y;this.state={nodes:e.nodes.map((e=>({...e,x:t,y:s}))),links:e.links.map((e=>({source:{...e.source,x:t,y:s},target:{...e.target,x:t,y:s}})))}}componentDidMount(){this.animate()}componentDidUpdate(e){e.nodes===this.props.nodes&&e.links===this.props.links||this.animate()}animate(){clearInterval(this.animation);let e=0,t=this.getAnimationContext(this.state,this.props);this.animation=setInterval((()=>{if(e++,e===this.props.steps)return clearInterval(this.animation),this.animation=null,void this.setState({nodes:this.props.nodes,links:this.props.links});this.setState(this.calculateNewState(t,e/this.props.steps))}),this.props.duration/this.props.steps)}getAnimationContext(e,t){let s=t.nodes.filter((t=>e.nodes.every((e=>!this.areNodesSame(t,e))))).map((s=>({base:s,old:this.getClosestAncestor(s,t,e),new:s}))),r=t.nodes.filter((t=>e.nodes.some((e=>this.areNodesSame(t,e))))).map((t=>({base:t,old:e.nodes.find((e=>this.areNodesSame(t,e))),new:t}))),i=e.nodes.filter((e=>t.nodes.every((t=>!this.areNodesSame(e,t))))).map((s=>({base:s,old:s,new:this.getClosestAncestor(s,e,t)}))),a=t.links.filter((t=>e.links.every((e=>!this.areLinksSame(t,e))))).map((s=>({base:s,old:this.getClosestAncestor(s.target,t,e),new:s}))),o=t.links.filter((t=>e.links.some((e=>this.areLinksSame(t,e))))).map((t=>({base:t,old:e.links.find((e=>this.areLinksSame(t,e))),new:t}))),p=e.links.filter((e=>t.links.every((t=>!this.areLinksSame(e,t))))).map((s=>({base:s,old:s,new:this.getClosestAncestor(s.target,e,t)})));return{nodes:r.concat(s).concat(i),links:o.concat(a).concat(p)}}getClosestAncestor(e,t,s){let r=e;for(;r;){let e=s.nodes.find((e=>this.areNodesSame(r,e)));if(e)return e;r=t.nodes.find((e=>(this.props.getChildren(e)||[]).some((e=>this.areNodesSame(r,e)))))}return s.nodes[0]}areNodesSame(e,t){return e.data[this.props.keyProp]===t.data[this.props.keyProp]}areLinksSame(e,t){return e.source.data[this.props.keyProp]===t.source.data[this.props.keyProp]&&e.target.data[this.props.keyProp]===t.target.data[this.props.keyProp]}calculateNewState(e,t){return{nodes:e.nodes.map((e=>this.calculateNodePosition(e.base,e.old,e.new,t))),links:e.links.map((e=>this.calculateLinkPosition(e.base,e.old,e.new,t)))}}calculateNodePosition(e,t,s,r){return{...e,x:this.calculateNewValue(t.x,s.x,r),y:this.calculateNewValue(t.y,s.y,r)}}calculateLinkPosition(e,t,s,r){return{source:{...e.source,x:this.calculateNewValue(t.source?t.source.x:t.x,s.source?s.source.x:s.x,r),y:this.calculateNewValue(t.source?t.source.y:t.y,s.source?s.source.y:s.y,r)},target:{...e.target,x:this.calculateNewValue(t.target?t.target.x:t.x,s.target?s.target.x:s.x,r),y:this.calculateNewValue(t.target?t.target.y:t.y,s.target?s.target.y:s.y,r)}}}calculateNewValue(e,t,s){return e+(t-e)*this.props.easing(s)}render(){return n.default.createElement(m,p.default({},this.props,this.state))}}class b extends n.default.PureComponent{static propTypes={data:d.default.object.isRequired,children:d.default.node,duration:d.default.number.isRequired,easing:d.default.func.isRequired,steps:d.default.number.isRequired,height:d.default.number.isRequired,width:d.default.number.isRequired,keyProp:d.default.string.isRequired,labelProp:d.default.string.isRequired,getChildren:d.default.func.isRequired,margins:d.default.shape({bottom:d.default.number.isRequired,left:d.default.number.isRequired,right:d.default.number.isRequired,top:d.default.number.isRequired}).isRequired,pathFunc:d.default.func,nodeShape:d.default.oneOf(["circle","image","polygon","rect"]).isRequired,nodeProps:d.default.object.isRequired,gProps:d.default.object.isRequired,pathProps:d.default.object.isRequired,svgProps:d.default.object.isRequired,textProps:d.default.object.isRequired};static defaultProps={duration:500,easing:s.easeQuadOut,getChildren:e=>e.children,steps:20,keyProp:"name",labelProp:"name",margins:{bottom:10,left:20,right:150,top:10},nodeShape:"circle",nodeProps:{},gProps:{},pathProps:{},svgProps:{},textProps:{}};render(){return n.default.createElement(y,p.default({duration:this.props.duration,easing:this.props.easing,getChildren:this.props.getChildren,height:this.props.height,keyProp:this.props.keyProp,labelProp:this.props.labelProp,nodeShape:this.props.nodeShape,nodeProps:this.props.nodeProps,pathFunc:this.props.pathFunc,steps:this.props.steps,width:this.props.width,gProps:{className:"node",...this.props.gProps},pathProps:{className:"link",...this.props.pathProps},svgProps:this.props.svgProps,textProps:this.props.textProps},u(this.props)),this.props.children)}}class q extends n.default.PureComponent{static propTypes={data:d.default.object.isRequired,animated:d.default.bool.isRequired,children:d.default.node,height:d.default.number.isRequired,width:d.default.number.isRequired,keyProp:d.default.string.isRequired,labelProp:d.default.string.isRequired,getChildren:d.default.func.isRequired,margins:d.default.shape({bottom:d.default.number.isRequired,left:d.default.number.isRequired,right:d.default.number.isRequired,top:d.default.number.isRequired}).isRequired,pathFunc:d.default.func,nodeShape:d.default.oneOf(["circle","image","polygon","rect"]).isRequired,nodeProps:d.default.object.isRequired,gProps:d.default.object.isRequired,pathProps:d.default.object.isRequired,svgProps:d.default.object.isRequired,textProps:d.default.object.isRequired};static defaultProps={animated:!1,getChildren:e=>e.children,keyProp:"name",labelProp:"name",margins:{bottom:10,left:20,right:150,top:10},nodeShape:"circle",nodeProps:{},gProps:{},pathProps:{},svgProps:{},textProps:{}};render(){return n.default.createElement(m,p.default({animated:this.props.animated,getChildren:this.props.getChildren,height:this.props.height,keyProp:this.props.keyProp,labelProp:this.props.labelProp,nodeShape:this.props.nodeShape,nodeProps:this.props.nodeProps,pathFunc:this.props.pathFunc,width:this.props.width,gProps:{className:"node",...this.props.gProps},pathProps:{className:"link",...this.props.pathProps},svgProps:this.props.svgProps,textProps:this.props.textProps},u(this.props)),this.props.children)}}e.AnimatedTree=b,e.Tree=q,Object.defineProperty(e,"__esModule",{value:!0})}));
